<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../../">
  <title data-ice="title">@twist/configuration/src/TwistConfiguration.js | Twist</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="React... with a twist!"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="Twist"><meta property="twitter:description" content="React... with a twist!"></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  <a href="test.html" data-ice="testLink">Test</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/adobe/twist"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#babel-plugin-transform-src-transforms">babel-plugin-transform/src/transforms</a><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-DecoratorDefinition">DecoratorDefinition</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#core-src">core/src</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/@twist/core/src/BaseStore.jsx~BaseStore.html">BaseStore</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/@twist/core/src/Binder.jsx~Binder.html">Binder</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/@twist/core/src/CollectionBinder.jsx~CollectionBinder.html">CollectionBinder</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/@twist/core/src/Disposable.jsx~Disposable.html">Disposable</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/@twist/core/src/ObjectId.jsx~ObjectId.html">ObjectId</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/@twist/core/src/ObservableArray.jsx~ObservableArray.html">ObservableArray</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/@twist/core/src/ObservableMap.jsx~ObservableMap.html">ObservableMap</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/@twist/core/src/ObservableSet.jsx~ObservableSet.html">ObservableSet</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/@twist/core/src/Scope.jsx~Scope.html">Scope</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/@twist/core/src/Signal.jsx~Signal.html">Signal</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/@twist/core/src/SignalDispatcher.jsx~SignalDispatcher.html">SignalDispatcher</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#core-src-decorators">core/src/decorators</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/@twist/core/src/decorators/State.jsx~State.html">State</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Abstract">Abstract</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Bind">Bind</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Cache">Cache</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Debounce">Debounce</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Delay">Delay</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Memoize">Memoize</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Observable">Observable</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Prototype">Prototype</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Throttle">Throttle</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Wrap">Wrap</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-state">state</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#core-src-middleware">core/src/middleware</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-protectorMiddleware">protectorMiddleware</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-remoteDevMiddleware">remoteDevMiddleware</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-thunkMiddleware">thunkMiddleware</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#react-src">react/src</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/@twist/react/src/BaseComponent.jsx~Component.html">Component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/@twist/react/src/BaseVirtualComponent.jsx~BaseVirtualComponent.html">BaseVirtualComponent</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">@twist/configuration/src/TwistConfiguration.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">/*
 *  Copyright 2016 Adobe Systems Incorporated. All rights reserved.
 *  This file is licensed to you under the Apache License, Version 2.0 (the &quot;License&quot;);
 *  you may not use this file except in compliance with the License. You may obtain a copy
 *  of the License at http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software distributed under
 *  the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS
 *  OF ANY KIND, either express or implied. See the License for the specific language
 *  governing permissions and limitations under the License.
 *
 */

const BabelConfig = require(&apos;./internal/BabelConfig&apos;);
const LibraryLoader = require(&apos;./internal/LibraryLoader&apos;);

const DEFAULT_OPTIONS = {
    includeBabelRuntime: false,
    jsxSourceLines: false,

    polyfill: true,
    regenerator: false,
    targets: { node: &apos;current&apos; },
    transformImports: true,
    useBabelModuleResolver: true,
};

module.exports = class TwistConfiguration {

    /**
     * Create a Twist configuration. A &quot;contextName&quot; describes the specific context in which this configuration is
     * being applied, such as &quot;node&quot; or &quot;webpack&quot;. The default context is &quot;node&quot;; other build systems
     * (like a webpack plugin) may subclass this configuration and provide additional functionality;
     * libraries should switch on `this.context` to decide how to add any plugins/loaders as necessary.
     *
     * @param {string} [contextName]
     * @param {object} [options]
     * @param {object} [env]
     */
    constructor(contextName, options = {}) {
        this._init(contextName, options);
    }

    _init(contextName, options) {
        this.context = contextName || &apos;node&apos;;

        // The options that you can configure (these are the default options below):
        this._options = Object.assign({}, DEFAULT_OPTIONS, options);

        // Twist compiler settings
        this._components = {};
        this._decorators = {};

        /** @property {Array&lt;[ BabelModule, object ]&gt;} */
        this._babelPlugins = [];

        // Path aliases (e.g. mapping an alias to a folder)
        this._pathAliases = {
            &apos;babel-runtime/helpers/inherits&apos;: require.resolve(&apos;./third_party/inherits&apos;)
        };

        this._libraryLoader = new LibraryLoader(this);

        if (options.root !== null) {
            this.addLibrary(options.root || process.cwd());
        }
    }

    /**
     * Get the current library. If not within a library (i.e. not inside an addLibrary() call), returns a
     * root library that has `parentLibrary` set to null.
     * @return {LibraryInfo}
     */
    get currentLibrary() {
        return this._libraryLoader.currentLibrary;
    }

    /**
     * Get the locations on disk of the loaded libraries.
     * @return {Object} A mapping from library name to path.
     */
    get libraryLocations() {
        let libraries = {};
        this._libraryLoader.libraryInfos.forEach(library =&gt; {
            libraries[library.name] = library.path;
        });
        return libraries;
    }

    /**
     * Utility for array entries in .twistrc - we support either:
     * * A map of key-value pairs
     * * An array of [key, value] entries
     *
     * If it&apos;s an array, we&apos;ll skip over any undefined values
     *
     * @param {Array|Object} config An array or map of items to add
     * @param {function} callback Method to apply to each entry
     */
    _forEachConfig(config, callback) {
        if (Array.isArray(config)) {
            config.forEach(entry =&gt; {
                if (!entry) {
                    return;
                }
                if (Array.isArray(entry)) {
                    callback(entry[0], entry[1] || {});
                }
                else {
                    callback(entry, {});
                }
            });
        }
        else if (config &amp;&amp; typeof config === &apos;object&apos;) {
            Object.keys(config).forEach(key =&gt; {
                callback(key, config[key]);
            });
        }
    }

    /**
     * Adds a .twistrc configuration to the Twist configuration
     * This shouldn&apos;t be called directly - it&apos;s called as a consequence of _libraryLoader.load().
     *
     * @param {Object} config The configuration from the .twistrc file
     */
    mergeConfig(config = {}) {

        // Add sub-libraries first
        this._forEachConfig(config.libraries, this.addLibrary.bind(this));

        // Decorators
        this._forEachConfig(config.decorators, (name, config) =&gt; {
            config.module = config.module || this.currentLibrary.name;
            config.export = config.export || name;
            if (config.inherits) {
                config.inherits = typeof config.inherits === &apos;string&apos; ? { export: config.inherits } : config.inherits;
                config.inherits.module = config.inherits.module || this.currentLibrary.name;
            }
            this.addDecorator(name, config);
        });

        // Components
        this._forEachConfig(config.components, (name, config) =&gt; {
            config.module = config.module || this.currentLibrary.name;
            config.export = config.export || name;
            this.addComponent(name, config);
        });

        // Babel plugins
        this._forEachConfig(config.babelPlugins, this.addBabelPlugin.bind(this));

        // Options
        this._forEachConfig(config.options, this.setOption.bind(this));

        // Contextual configuration - if you&apos;ve provided additional configuration under context[contextname],
        // we&apos;ll add that too (e.g. additional options only for a webpack environment).
        if (config.context) {
            this.mergeConfig(config.context[this.context]);
        }
    }

    /**
     * Add more Twist libraries to the configuration, using this method. e.g. `config.addLibrary(&apos;@twist/module&apos;);`
     * This allows the given library to add to the configuration (e.g. defining new decorators/components). This loads
     * the .twistrc file of the library, and adds it to the configuration.
     *
     * @param {string} library The npm name of the library to add (passes in the configuration to `library/config.js`)
     * @param {Object|value} [options] Options to pass to the library
     */
    addLibrary(library, options) {
        this._libraryLoader.load(library, options);
        return this;
    }

    /**
     * Add a custom Babel plugin.
     *
     * @param {BabelPlugin|string} plugin
     * @param {object} [options]
     */
    addBabelPlugin(plugin, options) {
        // Don&apos;t add a plugin more than once.
        if (this._babelPlugins.find(item =&gt; item[0] === plugin)) {
            return;
        }
        this._babelPlugins.push([ plugin, options ]);
        return this;
    }

    /**
     * Set an option in the Twist configuration. Supported options are:
     *
     * includeBabelRuntime      [true]      Include Babel runtime.
     * polyfill                 [true]      Include Babel polyfill (if including Babel runtime).
     * regenerator              [false]     Include Babel regenerator (if including Babel runtime).
     * targets                  [undefined] A babel-preset-env `targets` configuration, e.g. `{ browsers: &apos;last 2 versions&apos; }`.
     * transformImports         [false]     Transforms imports to CommonJS requires.
     * useBabelModuleResolver   [false]     Use the Babel module resolver to resolve imports.
     *
     * @param {string} name
     * @param {string|number|Boolean} value
     */
    setOption(name, value) {
        if (!this._options.hasOwnProperty(name)) {
            throw new Error(&apos;Twist Configuration option &apos; + name + &apos; is not defined.&apos;);
        }
        this._options[name] = value;
        return this;
    }

    /**
     * Get the value of an option in the Twist configuration.
     *
     * @param {string} name
     * @return {string|number|Boolean}
     */
    getOption(name) {
        return this._options[name];
    }

    /**
     * Add a global component to the Twist compiler configuration
     * @param {string} name
     * @param {Object} config
     */
    addComponent(name, config) {
        this._components[name] = config;
        return this;
    }

    /**
     * Add a decorator to the Twist compiler configuration
     * @param {string} name
     * @param {Object} config
     */
    addDecorator(name, config) {
        this._decorators[name] = config;
        return this;
    }

    /**
     * The configured components
     */
    get components() {
        return this._components;
    }

    /**
     * The configured decorators
     */
    get decorators() {
        return this._decorators;
    }

    /**
     * The complete Twist configuration options
     */
    get twistOptions() {
        const aliases = Object.assign({}, this.libraryLocations, this._pathAliases);
        const autoImport = Object.assign({}, this._decorators, this._components);
        const plugins = this._babelPlugins.slice();

        return Object.assign({}, this._options, {
            aliases,
            autoImport,
            plugins
        });
    }

    /**
     * The configuration of Babel (options passed via .babelrc, or to the webpack babel-loader).
     */
    get babelOptions() {
        return BabelConfig.build(this.twistOptions);
    }
};
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.0.4)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
